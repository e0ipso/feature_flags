<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Feature Flags - getVariantByUuid Helper Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h1 {
      color: #0678be;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 3px solid #0678be;
    }

    .test-info {
      background: #e7f5ff;
      padding: 20px;
      margin: 20px 0;
      border-radius: 4px;
      border-left: 4px solid #0678be;
    }

    .test-info h2 {
      margin-bottom: 15px;
      color: #333;
    }

    .test-info ul {
      margin-left: 20px;
    }

    .test-info li {
      margin: 5px 0;
    }

    .test-section {
      margin: 30px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .test-section h2 {
      color: #333;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #eee;
    }

    .test-section h3 {
      color: #666;
      font-size: 16px;
      font-style: italic;
      margin-bottom: 15px;
    }

    .result {
      margin: 15px 0;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .result.pass {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .result.fail {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    .instruction {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
      color: #856404;
    }

    .instruction strong {
      display: block;
      margin-bottom: 5px;
    }

    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }

    pre {
      background: #f4f4f4;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Feature Flags - getVariantByUuid Helper Test</h1>

    <div class="test-info">
      <h2>Test #79: BaseAlgorithm provides getVariantByUuid helper</h2>
      <p>This test verifies that the <code>getVariantByUuid()</code> method in BaseAlgorithm correctly retrieves variants by their UUID.</p>
      <ul>
        <li><strong>Purpose:</strong> Allow algorithms to look up variant objects by UUID</li>
        <li><strong>Method:</strong> getVariantByUuid(uuid) returns variant object or null</li>
        <li><strong>Requirement:</strong> Returns correct variant when UUID exists</li>
        <li><strong>Requirement:</strong> Returns null when UUID doesn't exist</li>
      </ul>
    </div>

    <div class="instruction">
      <strong>Test Strategy:</strong>
      This test creates a custom algorithm with multiple variants and verifies that getVariantByUuid() correctly retrieves them.
    </div>

    <!-- Test 1 -->
    <div class="test-section">
      <h2>Test 1: Returns correct variant for valid UUID</h2>
      <h3>Expected: getVariantByUuid() returns the matching variant object</h3>
      <div id="test1-result" class="result">Running...</div>
    </div>

    <!-- Test 2 -->
    <div class="test-section">
      <h2>Test 2: Returns null for invalid UUID</h2>
      <h3>Expected: getVariantByUuid() returns null when UUID doesn't exist</h3>
      <div id="test2-result" class="result">Running...</div>
    </div>

    <!-- Test 3 -->
    <div class="test-section">
      <h2>Test 3: Returns correct variant among multiple variants</h2>
      <h3>Expected: Correctly identifies the right variant from a list</h3>
      <div id="test3-result" class="result">Running...</div>
    </div>

    <!-- Test 4 -->
    <div class="test-section">
      <h2>Test 4: Returned variant has all expected properties</h2>
      <h3>Expected: Variant object contains uuid, label, and weight properties</h3>
      <div id="test4-result" class="result">Running...</div>
    </div>

    <!-- Test 5 -->
    <div class="test-section">
      <h2>Test 5: Works with edge cases</h2>
      <h3>Expected: Handles empty string, null, undefined appropriately</h3>
      <div id="test5-result" class="result">Running...</div>
    </div>
  </div>

  <!-- Load dependencies -->
  <script src="js/base/BaseAlgorithm.js"></script>

  <script>
    // Create a test algorithm that extends BaseAlgorithm
    class TestVariantLookupAlgorithm extends BaseAlgorithm {
      constructor(variants, config) {
        super(variants, config);
      }

      async decide(context) {
        // Simple implementation - not used for these tests
        return this.variants[0];
      }
    }

    // Helper function to display result
    function showResult(testId, passed, message) {
      const resultDiv = document.getElementById(testId);
      resultDiv.className = `result ${passed ? 'pass' : 'fail'}`;
      resultDiv.textContent = `Result: ${passed ? 'PASS' : 'FAIL'} - ${message}`;
    }

    // Run tests
    async function runTests() {
      try {
        // Setup test variants
        const variants = [
          { uuid: 'variant-a-uuid-123', label: 'Variant A', weight: 0 },
          { uuid: 'variant-b-uuid-456', label: 'Variant B', weight: 1 },
          { uuid: 'variant-c-uuid-789', label: 'Variant C', weight: 2 }
        ];

        const config = {};
        const algo = new TestVariantLookupAlgorithm(variants, config);

        // Test 1: Returns correct variant for valid UUID
        const variantA = algo.getVariantByUuid('variant-a-uuid-123');
        const test1Pass = variantA !== null &&
                         variantA.uuid === 'variant-a-uuid-123' &&
                         variantA.label === 'Variant A';

        showResult(
          'test1-result',
          test1Pass,
          test1Pass
            ? `Correctly returned variant: ${JSON.stringify(variantA)}`
            : `Expected Variant A, got: ${JSON.stringify(variantA)}`
        );

        // Test 2: Returns null for invalid UUID
        const invalidVariant = algo.getVariantByUuid('non-existent-uuid-999');
        const test2Pass = invalidVariant === null;

        showResult(
          'test2-result',
          test2Pass,
          test2Pass
            ? `Correctly returned null for invalid UUID`
            : `Expected null, got: ${JSON.stringify(invalidVariant)}`
        );

        // Test 3: Returns correct variant among multiple variants
        const variantB = algo.getVariantByUuid('variant-b-uuid-456');
        const variantC = algo.getVariantByUuid('variant-c-uuid-789');

        const test3Pass = variantB !== null &&
                         variantB.uuid === 'variant-b-uuid-456' &&
                         variantB.label === 'Variant B' &&
                         variantC !== null &&
                         variantC.uuid === 'variant-c-uuid-789' &&
                         variantC.label === 'Variant C';

        showResult(
          'test3-result',
          test3Pass,
          test3Pass
            ? `Correctly retrieved all 3 variants:\n  - ${variantA.label}\n  - ${variantB.label}\n  - ${variantC.label}`
            : `Failed to retrieve correct variants`
        );

        // Test 4: Returned variant has all expected properties
        const testVariant = algo.getVariantByUuid('variant-a-uuid-123');
        const hasUuid = testVariant && typeof testVariant.uuid === 'string';
        const hasLabel = testVariant && typeof testVariant.label === 'string';
        const hasWeight = testVariant && typeof testVariant.weight === 'number';

        const test4Pass = hasUuid && hasLabel && hasWeight;

        showResult(
          'test4-result',
          test4Pass,
          test4Pass
            ? `Variant has all expected properties:\n  - uuid: "${testVariant.uuid}"\n  - label: "${testVariant.label}"\n  - weight: ${testVariant.weight}`
            : `Missing properties: ${!hasUuid ? 'uuid ' : ''}${!hasLabel ? 'label ' : ''}${!hasWeight ? 'weight' : ''}`
        );

        // Test 5: Works with edge cases
        const results = {
          emptyString: algo.getVariantByUuid(''),
          null: algo.getVariantByUuid(null),
          undefined: algo.getVariantByUuid(undefined),
          number: algo.getVariantByUuid(123),
          object: algo.getVariantByUuid({}),
        };

        // All edge cases should return null (or not throw errors)
        const test5Pass = results.emptyString === null &&
                         results.null === null &&
                         results.undefined === null &&
                         results.number === null &&
                         results.object === null;

        showResult(
          'test5-result',
          test5Pass,
          test5Pass
            ? `All edge cases handled correctly (returned null):\n  - Empty string: ${results.emptyString}\n  - null: ${results.null}\n  - undefined: ${results.undefined}\n  - number: ${results.number}\n  - object: ${results.object}`
            : `Some edge cases not handled correctly`
        );

      } catch (error) {
        console.error('Test execution failed:', error);
        showResult('test1-result', false, `Error: ${error.message}`);
        showResult('test2-result', false, `Error: ${error.message}`);
        showResult('test3-result', false, `Error: ${error.message}`);
        showResult('test4-result', false, `Error: ${error.message}`);
        showResult('test5-result', false, `Error: ${error.message}`);
      }
    }

    // Run tests when page loads
    window.addEventListener('load', runTests);
  </script>
</body>
</html>
